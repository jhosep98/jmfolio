generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String      @id @default(cuid())
  email         String      @unique
  password      String      
  name          String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  positions     Position[]
  transactions  Transaction[]
  goals         Goal[]
}

model Position {
  id            String      @id @default(cuid())
  userId        String
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  ticker        String      // e.g., "AAPL", "BTC"
  name          String      // e.g., "Apple Inc.", "Bitcoin"
  type          AssetType   // STOCK, CRYPTO, CASH, ETF
  quantity      Float
  avgPrice      Float       // Average purchase price
  currentPrice  Float       // Current market price (manual)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  transactions  Transaction[]

  @@index([userId])
  @@unique([userId, ticker])
}

model Transaction {
  id            String          @id @default(cuid())
  userId        String
  user          User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  positionId    String
  position      Position        @relation(fields: [positionId], references: [id], onDelete: Cascade)
  type          TransactionType // BUY, SELL
  quantity      Float
  pricePerUnit  Float
  fees          Float           @default(0)
  total         Float           // Calculated: quantity * pricePerUnit + fees
  notes         String?
  date          DateTime        @default(now())
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  @@index([userId])
  @@index([positionId])
  @@index([date])
}

model Goal {
  id            String      @id @default(cuid())
  userId        String
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  title         String
  targetAmount  Float
  deadline      DateTime?
  achieved      Boolean     @default(false)
  achievedAt    DateTime?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@index([userId])
}

enum AssetType {
  STOCK
  CRYPTO
  CASH
  ETF
}

enum TransactionType {
  BUY
  SELL
}
